<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalendarz widzeń</title>
<style>
  body { font-family: Arial; background: #f2f2f2; padding: 20px; }
  h2 { margin-bottom: 10px; }
  .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; max-width: 650px; margin-top:20px; }
  .day { background: white; padding: 20px; border-radius: 5px; text-align: center; cursor: pointer; font-size: 18px; }
  .mine { background: #8ecaff; }
  .hers { background: #ffb3b3; }
</style>
</head>
<body>

<h2>Kalendarz widzeń</h2>
<p>Kliknij dzień, aby zaznaczyć obecność dziecka.</p>

<!-- Wybór osoby, dla której zaznaczamy dzień -->
<label>Wybierz osobę: </label>
<select id="userSelect">
  <option value="father">U mnie</option>
  <option value="mother">U niej</option>
</select>

<div id="calendar" class="calendar"></div>

<!-- Skrypt korzysta z Firebase JS SDK przez <script type="module"> -->
<script type="module">
  // Importujemy tylko potrzebne funkcje z Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  /*
  Konfiguracja Firebase:
  - Skopiowana z Firebase Console (Use a <script> tag)
  - Nie używamy Analytics, aby działało od razu na GitHub Pages
  - databaseURL musi być włączone, aby połączenie działało
  */
  const firebaseConfig = {
    apiKey: "AIzaSyCJ3yA2mf__-AAD8u2I5UvC2J6pgnujghw",
    authDomain: "kalendarz-40e73.firebaseapp.com",
    databaseURL: "https://kalendarz-40e73-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "kalendarz-40e73",
    storageBucket: "kalendarz-40e73.firebasestorage.app",
    messagingSenderId: "344452591730",
    appId: "1:344452591730:web:dcf6acace0305b43c492eb"
  };

  // Inicjalizacja Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Tworzenie prostego kalendarza 31 dni
  const calendarEl = document.getElementById("calendar");
  const userSelect = document.getElementById("userSelect");

  for (let i = 1; i <= 31; i++) {
    const dayEl = document.createElement("div");
    dayEl.classList.add("day");
    dayEl.textContent = i;
    dayEl.dataset.day = i;

    dayEl.addEventListener("click", () => {
      // Zapis do Realtime Database po kliknięciu dnia
      set(ref(db, "calendar/day" + i), userSelect.value);
    });

    calendarEl.appendChild(dayEl);
  }

  // Odczyt danych w czasie rzeczywistym i aktualizacja kolorów dni
  onValue(ref(db, "calendar"), (snapshot) => {
    const data = snapshot.val();
    document.querySelectorAll(".day").forEach(day => {
      const nr = day.dataset.day;
      day.classList.remove("mine","hers");
      if (!data || !data["day" + nr]) return;
      if (data["day" + nr] === "father") day.classList.add("mine");
      if (data["day" + nr] === "mother") day.classList.add("hers");
    });
  });

  /*
  Wskazówki dotyczące Firebase:
  1. W konsoli Firebase wybierz "Build -> Realtime Database"
  2. Włącz test mode lub ustaw reguły bezpieczeństwa:
     {
       ".read": true,
       ".write": true
     }
     aby kalendarz działał stale bez ograniczeń czasowych
  3. Jeśli chcesz ograniczyć dostęp tylko do zalogowanych użytkowników, użyj auth != null w regułach
  */
</script>

</body>
</html>