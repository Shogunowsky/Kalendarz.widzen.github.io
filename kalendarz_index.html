<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalendarz widzeń</title>
<style>
  body { font-family: Arial; background: #f2f2f2; padding: 20px; }
  h2 { margin-bottom: 10px; }
  .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; max-width: 650px; margin-top:20px; }
  .day { background: white; padding: 20px; border-radius: 5px; text-align: center; cursor: pointer; font-size: 18px; }
  .mine { background: #8ecaff; }
  .hers { background: #ffb3b3; }
</style>
</head>
<body>

<h2>Kalendarz widzeń</h2>
<p>Kliknij dzień, aby zaznaczyć obecność dziecka.</p>

<label>Wybierz osobę: </label>
<select id="userSelect">
  <option value="father">U mnie</option>
  <option value="mother">U niej</option>
</select>

<div id="calendar" class="calendar"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

  // Poprawiona konfiguracja Firebase bez Analytics
  const firebaseConfig = {
    apiKey: "AIzaSyCJ3yA2mf__-AAD8u2I5UvC2J6pgnujghw",
    authDomain: "kalendarz-40e73.firebaseapp.com",
    databaseURL: "https://kalendarz-40e73-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "kalendarz-40e73",
    storageBucket: "kalendarz-40e73.firebasestorage.app",
    messagingSenderId: "344452591730",
    appId: "1:344452591730:web:55d6f10d61dc755ec492eb"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const calendarEl = document.getElementById("calendar");
  const userSelect = document.getElementById("userSelect");

  const days = 31;

  for (let i = 1; i <= days; i++) {
    const dayEl = document.createElement("div");
    dayEl.classList.add("day");
    dayEl.textContent = i;
    dayEl.dataset.day = i;

    dayEl.addEventListener("click", () => {
      const selected = userSelect.value;
      set(ref(db, "calendar/day" + i), selected);
    });

    calendarEl.appendChild(dayEl);
  }

  onValue(ref(db, "calendar"), (snapshot) => {
    const data = snapshot.val();

    document.querySelectorAll(".day").forEach(day => {
      const nr = day.dataset.day;
      day.classList.remove("mine", "hers");

      if (!data || !data["day" + nr]) return;

      if (data["day" + nr] === "father") day.classList.add("mine");
      if (data["day" + nr] === "mother") day.classList.add("hers");
    });
  });
</script>

</body>
</html>